<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>연금복권720+ 빈도 기반 추천기</title>
  <style>
    :root{
      --bg:#0b0f18; --card:#111a2b; --line:#1e2a44; --txt:#eaf0ff; --muted:#a9b6d6;
      --accent:#7aa7ff; --good:#3ddc97; --warn:#ffcc66;
      --g:#ff6b6b;
      --p0:#6aa3ff; --p1:#7cddff; --p2:#7dffb2; --p3:#ffe066; --p4:#ff9f7a; --p5:#c59cff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 600px at 20% 0%, #142246 0%, var(--bg) 55%); color:var(--txt); font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;}
    a{color:var(--accent);text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .title{display:flex;flex-direction:column;gap:6px;margin-bottom:14px}
    .title h1{font-size:20px;margin:0}
    .title .sub{color:var(--muted);font-size:13px;line-height:1.35}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:900px){.grid{grid-template-columns:1.2fr .8fr}}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid var(--line); border-radius:16px; padding:14px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btns{display:flex;gap:10px;flex-wrap:wrap}
    button{
      appearance:none;border:1px solid var(--line); background:#0f1729; color:var(--txt);
      padding:10px 12px;border-radius:12px; font-weight:700; cursor:pointer;
      transition:transform .06s ease, border-color .2s ease, background .2s ease;
    }
    button:hover{border-color:#2c3e69}
    button:active{transform:translateY(1px)}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:7px 10px;border-radius:999px;border:1px solid var(--line); background:#0f1729;color:var(--muted);font-size:12px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .sets{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .set{border:1px solid var(--line); background:#0f1729; border-radius:14px; padding:12px}
    .setHead{display:flex;justify-content:space-between;gap:10px;align-items:center; flex-wrap:wrap}
    .tag{font-size:12px;color:var(--muted)}
    .balls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:10px}
    .ball{
      width:40px;height:40px;border-radius:999px;display:flex;align-items:center;justify-content:center;
      color:#0b0f18;font-weight:900;
      box-shadow:0 8px 18px rgba(0,0,0,.35), inset 0 0 0 2px rgba(255,255,255,.10);
      user-select:none;
    }
    .ball.g{background:var(--g); color:#0b0f18}
    .ball.p0{background:var(--p0)}
    .ball.p1{background:var(--p1)}
    .ball.p2{background:var(--p2)}
    .ball.p3{background:var(--p3)}
    .ball.p4{background:var(--p4)}
    .ball.p5{background:var(--p5)}
    .hint{font-size:12px;color:var(--muted);line-height:1.45}
    .small{font-size:12px;color:var(--muted)}
    .hr{height:1px;background:var(--line);margin:12px 0}
    .freq{display:grid;grid-template-columns:repeat(5, 1fr); gap:8px; margin-top:10px}
    .freq .cell{border:1px solid var(--line); background:#0f1729; border-radius:12px; padding:10px}
    .cell .k{font-size:12px;color:var(--muted)}
    .cell .v{font-size:16px;font-weight:800;margin-top:4px}
    .warn{color:var(--warn);font-weight:800}
    .good{color:var(--good);font-weight:800}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">
      <h1>연금복권720+ 빈도 기반 추천기 (무작위 X)</h1>
      <div class="sub">
        역대 당첨(1등 조/6자리 + 보너스)을 집계한 <span class="good">빈도 기반</span> 추천이야.  
        <span class="warn">과거 빈도는 미래 당첨을 보장하지 않아</span>. 그래도 “데이터 기반”으로 보기 좋게 뽑아준다.
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="row" style="justify-content:space-between;">
          <div class="pill">데이터 갱신: <span id="updatedAt" class="mono">로딩중…</span></div>
          <div class="pill">회차: <span id="roundRange" class="mono">로딩중…</span></div>
        </div>

        <div class="hr"></div>

        <div class="btns">
          <button id="b1">번호 1개 추천</button>
          <button id="b5">번호 5개 추천</button>
          <button id="b10">번호 10개 추천</button>
        </div>

        <div class="hint" style="margin-top:10px">
          버튼을 누를 때마다 <b>무작위가 아니라</b>, “최신회차(seed) + 클릭 순번(cycle)” 규칙으로 세트가 <b>순환</b>하면서 바뀐다.
        </div>

        <div id="sets" class="sets"></div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center">
          <div style="font-size:14px;font-weight:900">요약(상위 빈도 힌트)</div>
          <div class="small">표시는 “상위 1~2순위”만 빠르게 보여줌</div>
        </div>

        <div id="summary" class="freq"></div>

        <div class="hr"></div>
        <div class="hint">
          소스: 공개 페이지 파싱(동행복권 GitHub IP 차단 이슈 회피).  
          데이터가 갱신 안 되면 소스 페이지 구조가 바뀐 거라 스크립트만 살짝 손보면 된다.
        </div>
      </div>
    </div>
  </div>

<script>
  const $ = (s) => document.querySelector(s);

  const PATH_FREQ  = "../data/yeongeum720_freq.json";
  const PATH_DRAWS = "../data/yeongeum720_draws.json";

  function cacheBust(url){ return url + (url.includes("?") ? "&" : "?") + "v=" + Date.now(); }

  function getCycleKey(n){ return "yeongeum720_cycle_" + n; }
  function getCycle(n){ return Number(localStorage.getItem(getCycleKey(n)) || "0"); }
  function setCycle(n, v){ localStorage.setItem(getCycleKey(n), String(v)); }

  function generateSets(freq, howMany, cycle){
    const seedRound = freq.rounds.max;
    const groupRank = freq.group.ranked.map(x => x.digit);
    const posRank = freq.positions.map(p => p.ranked.map(x => x.digit)); // 6 x 10

    const patterns = [
      { name: "상위", g: 0, o: [0,0,0,0,0,0] },
      { name: "상위-교차", g: 1, o: [1,0,1,0,1,0] },
      { name: "혼합-분산", g: 2, o: [0,3,1,4,2,5] },
      { name: "중위", g: 0, o: [5,5,5,5,5,5] },
      { name: "중위-교차", g: 3, o: [6,5,6,5,6,5] },
      { name: "하위-스파이스", g: 4, o: [8,7,6,8,7,6] },
      { name: "상위+보정", g: 1, o: [0,1,2,1,0,2] },
      { name: "혼합-교대", g: 2, o: [2,6,1,7,0,8] },
      { name: "끝자리강조", g: 0, o: [4,4,4,4,2,0] },
      { name: "분산-깊게", g: 3, o: [3,7,4,8,5,9] },
    ];

    const base = (seedRound + cycle) % 10;

    const out = [];
    for(let i=0;i<howMany;i++){
      const pat = patterns[i % patterns.length];
      const group = groupRank[(pat.g + (seedRound % groupRank.length)) % groupRank.length];

      const digits = [];
      for(let p=0;p<6;p++){
        const rankIdx = (pat.o[p] + base + i) % 10;
        digits.push(posRank[p][rankIdx]);
      }

      const key = `${group}-${digits.join("")}`;
      if(out.some(s => `${s.group}-${s.number}` === key)){
        digits[5] = posRank[5][(rankIdx + 1) % 10];
      }

      out.push({ label: i+1, mode: pat.name, group, digits, number: digits.join("") });
    }
    return out;
  }

  function renderSets(sets){
    const el = $("#sets");
    el.innerHTML = "";

    sets.forEach(s => {
      const div = document.createElement("div");
      div.className = "set";

      div.innerHTML = `
        <div class="setHead">
          <div><b>${s.label}.</b> <span class="mono">${s.group}조 ${s.number}</span></div>
          <div class="tag">패턴: ${s.mode}</div>
        </div>
        <div class="balls">
          <div class="ball g" title="조">${s.group}조</div>
          <div class="ball p0" title="십만">${s.digits[0]}</div>
          <div class="ball p1" title="만">${s.digits[1]}</div>
          <div class="ball p2" title="천">${s.digits[2]}</div>
          <div class="ball p3" title="백">${s.digits[3]}</div>
          <div class="ball p4" title="십">${s.digits[4]}</div>
          <div class="ball p5" title="일">${s.digits[5]}</div>
        </div>
      `;
      el.appendChild(div);
    });
  }

  function renderSummary(freq){
    const topGroup = freq.group.ranked[0];
    const posTop = freq.positions.map(p => p.ranked[0]);
    const summary = $("#summary");
    summary.innerHTML = "";

    const cells = [
      { k: "최빈 조(1등)", v: `${topGroup.digit}조 (${topGroup.count})` },
      { k: "십만(Top)", v: `${posTop[0].digit} (${posTop[0].count})` },
      { k: "만(Top)", v: `${posTop[1].digit} (${posTop[1].count})` },
      { k: "천(Top)", v: `${posTop[2].digit} (${posTop[2].count})` },
      { k: "끝자리(Top)", v: `${posTop[5].digit} (${posTop[5].count})` },
    ];

    cells.forEach(c => {
      const d = document.createElement("div");
      d.className = "cell";
      d.innerHTML = `<div class="k">${c.k}</div><div class="v mono">${c.v}</div>`;
      summary.appendChild(d);
    });
  }

  async function load(){
    const freq = await fetch(cacheBust(PATH_FREQ)).then(r => r.json());
    $("#updatedAt").textContent = freq.updatedAt;
    $("#roundRange").textContent = `${freq.rounds.min} ~ ${freq.rounds.max} (총 ${freq.rounds.count}회)`;
    renderSummary(freq);

    function run(n){
      const cycle = getCycle(n) + 1;
      setCycle(n, cycle);
      const sets = generateSets(freq, n, cycle);
      renderSets(sets);
    }

    $("#b1").onclick  = () => run(1);
    $("#b5").onclick  = () => run(5);
    $("#b10").onclick = () => run(10);
  }

  load().catch(e => {
    $("#updatedAt").textContent = "로딩 실패";
    $("#sets").innerHTML = `<div class="hint">데이터 로딩 실패: ${String(e)}</div>`;
  });
</script>
</body>
</html>
