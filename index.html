<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>연금복권720+ 빈도 기반 추천기</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --card2:#0f1730;
      --text:#e9eeff; --muted:#aab4de; --line:#24305f;
      --accent:#7aa2ff; --good:#35d399; --warn:#ffd166;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --r:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      background: radial-gradient(1200px 700px at 20% 0%, #15204a 0%, var(--bg) 50%, #070a14 100%);
      color:var(--text);
    }
    a{color:var(--accent); text-decoration:none}
    .wrap{max-width:980px; margin:0 auto; padding:20px}
    header{
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
      padding:18px 18px 14px; border:1px solid var(--line); border-radius:var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow:var(--shadow);
    }
    .title{display:flex; flex-direction:column; gap:6px}
    .title h1{margin:0; font-size:18px; letter-spacing:-.2px}
    .sub{margin:0; color:var(--muted); font-size:13px; line-height:1.35}
    .meta{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end}
    .pill{
      font-size:12px; color:var(--muted);
      padding:8px 10px; border:1px solid var(--line); border-radius:999px;
      background: rgba(0,0,0,.18);
    }

    .panel{
      margin-top:14px;
      display:grid; gap:12px;
      grid-template-columns: 1fr;
    }
    .card{
      border:1px solid var(--line); border-radius:var(--r);
      background: rgba(18,26,51,.65);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:14px 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,0));
      border-bottom:1px solid rgba(36,48,95,.55);
    }
    .card .hd b{font-size:14px}
    .card .bd{padding:14px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}

    .btns{display:flex; gap:10px; flex-wrap:wrap}
    button{
      cursor:pointer; border:1px solid rgba(122,162,255,.35);
      background: rgba(122,162,255,.12);
      color:var(--text);
      padding:10px 12px; border-radius:12px; font-weight:700; font-size:13px;
      transition: transform .06s ease, background .2s ease;
    }
    button:active{transform: scale(.98)}
    button.secondary{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color:var(--muted);
      font-weight:600;
    }

    .grid{
      display:grid; gap:10px;
      grid-template-columns: repeat(1, 1fr);
    }
    @media (min-width: 720px){
      .grid{grid-template-columns: repeat(2, 1fr);}
    }

    .ticket{
      padding:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      border-radius:14px;
      display:flex; flex-direction:column; gap:8px;
    }
    .topline{
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    .left{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .group{
      min-width:52px;
      display:inline-flex; align-items:center; justify-content:center;
      padding:8px 10px; border-radius:999px;
      font-weight:900; font-size:13px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
    }
    .mode{
      font-size:12px; color:var(--muted);
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
    }
    .balls{display:flex; gap:6px; align-items:center; flex-wrap:wrap}
    .ball{
      width:34px; height:34px; border-radius:999px;
      display:inline-flex; align-items:center; justify-content:center;
      font-weight:900; font-size:15px;
      border:1px solid rgba(255,255,255,.14);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.18);
      user-select:none;
    }
    .ball.roll{animation: pop .35s ease both}
    @keyframes pop{
      0%{transform:translateY(2px) scale(.98); filter:brightness(.95)}
      60%{transform:translateY(-1px) scale(1.03); filter:brightness(1.12)}
      100%{transform:translateY(0) scale(1); filter:brightness(1)}
    }

    /* digit color (0~9) */
    .d0{background:#2dd4bf1f; color:#bff7ef}
    .d1{background:#60a5fa22; color:#cfe5ff}
    .d2{background:#a78bfa22; color:#eadcff}
    .d3{background:#fb718522; color:#ffe0e6}
    .d4{background:#fbbf2422; color:#fff1cc}
    .d5{background:#34d39922; color:#d7ffef}
    .d6{background:#22c55e22; color:#d5ffe4}
    .d7{background:#f9731622; color:#ffe4d1}
    .d8{background:#e879f922; color:#ffe3ff}
    .d9{background:#94a3b822; color:#edf2ff}

    /* group color (1~5) */
    .g1{background:rgba(96,165,250,.16); color:#d8ecff}
    .g2{background:rgba(167,139,250,.16); color:#f1e9ff}
    .g3{background:rgba(251,113,133,.16); color:#ffe3ea}
    .g4{background:rgba(251,191,36,.16); color:#fff0c9}
    .g5{background:rgba(52,211,153,.16); color:#d9fff0}

    .hintline{
      font-size:12px; color:var(--muted); line-height:1.35;
      padding:9px 10px;
      border:1px dashed rgba(255,255,255,.12);
      border-radius:12px;
      background: rgba(0,0,0,.14);
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .hintline b{color:#dce5ff}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace}

    .note{
      margin-top:10px;
      font-size:12px; color:var(--muted); line-height:1.45;
      padding:10px 12px; border:1px dashed rgba(255,255,255,.16);
      border-radius:12px; background: rgba(0,0,0,.15);
    }
    .err{
      padding:12px; border-radius:14px;
      border:1px solid rgba(255,209,102,.35);
      background: rgba(255,209,102,.12);
      color:#ffe9b7;
      line-height:1.45;
      font-size:13px;
      white-space:pre-wrap;
    }
    .small{font-size:12px; color:var(--muted)}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>연금복권720+ 빈도 기반 추천기</h1>
        <p class="sub">
          <b>1개=최빈 고정</b> / <b>5개=상위(Top) 혼합</b> / <b>10개=상~중~하 분산</b> (무작위 사용 안 함)
        </p>
      </div>
      <div class="meta">
        <div class="pill" id="pill-round">회차: -</div>
        <div class="pill" id="pill-updated">업데이트: -</div>
        <a class="pill" href="https://www.dhlottery.co.kr/pt720/intro" target="_blank" rel="noopener">공식 안내</a>
      </div>
    </header>

    <div class="panel">
      <section class="card">
        <div class="hd">
          <b>추천 생성</b>
          <span class="small">5/10개는 클릭할수록 “순환(cycle)”으로 패턴이 바뀜(무작위 X)</span>
        </div>
        <div class="bd">
          <div class="row">
            <div class="btns">
              <button id="b1">번호 1개 추천</button>
              <button id="b5">번호 5개 추천</button>
              <button id="b10">번호 10개 추천</button>
              <button class="secondary" id="bReset">사이클 리셋</button>
            </div>
          </div>
          <div class="note">
            ※ 2등은 <b>조만 바뀌고 6자리는 동일</b> / 3등은 <b>끝 5자리 일치</b> 조건이라, 추천 결과에 <b>2등·3등 힌트</b>를 같이 보여줍니다.
          </div>
        </div>
      </section>

      <section class="card">
        <div class="hd">
          <b>추천 결과</b>
          <span class="small" id="status">데이터 로딩 중…</span>
        </div>
        <div class="bd">
          <div id="out" class="grid"></div>
          <div id="err" class="err" style="display:none;"></div>
        </div>
      </section>
    </div>
  </div>

<script>
  // ✅ 경로가 어디서 열려도 안 깨지게 프로젝트 루트 기준으로 고정
  const PROJECT_ROOT = location.pathname.includes("/yeongeum720/")
    ? new URL("../", location.href)   // /<repo>/yeongeum720/ → /<repo>/
    : new URL("./", location.href);   // /<repo>/ → /<repo>/

  const PATH_FREQ  = new URL("data/yeongeum720_freq.json", PROJECT_ROOT).toString();
  const PATH_DRAWS = new URL("data/yeongeum720_draws.json", PROJECT_ROOT).toString();

  let freq = null;

  const $ = (sel) => document.querySelector(sel);
  const cacheBust = (url) => url + (url.includes("?") ? "&" : "?") + "v=" + Date.now();

  function setText(id, t){ $(id).textContent = t; }

  function readCycle(key){
    const v = localStorage.getItem(key);
    const n = v ? parseInt(v, 10) : 0;
    return Number.isFinite(n) ? n : 0;
  }
  function writeCycle(key, n){
    localStorage.setItem(key, String(n));
  }

  function ranksFromFreq(freq){
    const groupRank = (freq.group?.ranked || []).map(x => x.digit);
    const posRank = (freq.positions || []).map(p => (p.ranked || []).map(x => x.digit));
    return { groupRank, posRank };
  }

  function makeHints(group, digits){
    const number = digits.join("");
    const last5 = number.slice(1); // 끝 5자리
    const secondGroups = [1,2,3,4,5].filter(g => g !== group);
    return { number, last5, secondGroups };
  }

  // ─────────────────────────────────────────────────────────
  // 추천 규칙
  // 1개: 최빈 고정(항상 동일)
  // 5개: 상위(Top 3) 혼합 + cycle로 순환
  // 10개: 상~중~하(Top~Mid~Low) 분산 + cycle로 순환
  function recommendFixedTop1(){
    const { groupRank, posRank } = ranksFromFreq(freq);
    const group = groupRank[0] ?? 1;
    const digits = posRank.map(r => (r[0] ?? 0)).slice(0,6);
    return [{ label: "1", mode: "최빈 고정", group, digits, ...makeHints(group, digits) }];
  }

  function recommendTopMix5(cycle){
    const { groupRank, posRank } = ranksFromFreq(freq);
    const topSpan = 3;
    const gSpan = Math.min(2, groupRank.length || 2);

    const patterns = [
      [0,0,0,0,0,0],
      [1,0,1,0,1,0],
      [0,1,0,1,0,1],
      [2,1,2,1,2,1],
      [1,2,1,2,1,2],
    ];

    const out = [];
    const base = cycle % topSpan;

    for(let i=0;i<5;i++){
      const pat = patterns[i];
      const group = groupRank[(i + cycle) % gSpan] ?? (groupRank[0] ?? 1);

      const digits = [];
      for(let p=0;p<6;p++){
        const r = posRank[p] || [0,1,2,3,4,5,6,7,8,9];
        const span = Math.min(topSpan, r.length);
        const idx = (pat[p] + base + i) % span;
        digits.push(r[idx] ?? 0);
      }

      out.push({ label: String(i+1), mode: "상위 혼합", group, digits, ...makeHints(group, digits) });
    }
    return out;
  }

  function recommendSpread10(cycle){
    const { groupRank, posRank } = ranksFromFreq(freq);

    // 각 세트가 서로 다른 “랭크대(상/중/하)”를 쓰도록 고정 패턴
    const patterns = [
      [0,0,0,0,0,0],     // 상
      [1,1,1,1,1,1],     // 상
      [2,2,2,2,2,2],     // 상(끝)
      [3,4,3,4,3,4],     // 중
      [4,3,4,3,4,3],     // 중
      [5,6,5,6,5,6],     // 중~하
      [6,5,6,5,6,5],     // 중~하
      [7,8,7,8,7,8],     // 하
      [8,7,8,7,8,7],     // 하
      [9,9,9,9,9,9],     // 최하
    ];

    const out = [];
    const base = cycle % 10;

    for(let i=0;i<10;i++){
      const pat = patterns[i];
      const group = groupRank[(i + cycle) % (groupRank.length || 5)] ?? 1;

      const digits = [];
      for(let p=0;p<6;p++){
        const r = posRank[p] || [0,1,2,3,4,5,6,7,8,9];
        const idx = (pat[p] + base + p + i) % r.length; // 살짝 분산
        digits.push(r[idx] ?? 0);
      }

      out.push({ label: String(i+1), mode: "상~중~하 분산", group, digits, ...makeHints(group, digits) });
    }
    return out;
  }

  // ─────────────────────────────────────────────────────────
  function ballEl(d, delayMs=0){
    const s = document.createElement("span");
    s.className = "ball d" + d + " roll";
    s.style.animationDelay = delayMs + "ms";
    s.textContent = String(d);
    return s;
  }

  function ticketEl(t){
    const card = document.createElement("div");
    card.className = "ticket";

    const topline = document.createElement("div");
    topline.className = "topline";

    const left = document.createElement("div");
    left.className = "left";

    const g = document.createElement("span");
    g.className = "group g" + t.group;
    g.textContent = t.group + "조";

    const balls = document.createElement("div");
    balls.className = "balls";

    t.digits.forEach((d, i)=>{
      balls.appendChild(ballEl(d, i * 35));
    });

    left.appendChild(g);
    left.appendChild(balls);

    const right = document.createElement("span");
    right.className = "mode";
    right.textContent = t.mode;

    topline.appendChild(left);
    topline.appendChild(right);

    const h = document.createElement("div");
    h.className = "hintline";

    // 2등: 조만 바뀜
    const secondText = t.secondGroups
      .map(g => `${g}조`)
      .join(", ");

    h.innerHTML = `
      <span><b>2등(조만 변경):</b> <span class="mono">${secondText} + ${t.number}</span></span>
      <span>│</span>
      <span><b>3등(끝 5자리):</b> <span class="mono">${t.last5}</span></span>
    `;

    card.appendChild(topline);
    card.appendChild(h);

    return card;
  }

  function render(list){
    const out = $("#out");
    out.innerHTML = "";
    list.forEach((t)=> out.appendChild(ticketEl(t)));
  }

  async function load(){
    try{
      const res = await fetch(cacheBust(PATH_FREQ));
      if(!res.ok) throw new Error(`freq fetch failed: ${res.status} ${res.statusText}\nURL: ${PATH_FREQ}`);
      freq = await res.json();

      const maxRound = freq.rounds?.max ?? "-";
      setText("#pill-round", "회차: " + maxRound);
      setText("#pill-updated", "업데이트: " + (freq.updatedAt ? freq.updatedAt.replace("T"," ").replace("Z"," UTC") : "-"));
      setText("#status", "준비 완료");
    }catch(e){
      $("#err").style.display = "block";
      $("#err").textContent =
        "데이터 로딩 실패\n\n" +
        "- Actions에서 data/*.json이 생성/커밋됐는지 확인하세요.\n" +
        "- 에러: " + (e?.message || e);
      setText("#status", "오류");
    }
  }

  $("#b1").addEventListener("click", ()=>{
    if(!freq) return;
    // 1개는 최빈 고정(사이클 영향 없음)
    render(recommendFixedTop1());
  });

  $("#b5").addEventListener("click", ()=>{
    if(!freq) return;
    const k = "yeongeum720_cycle_5";
    const cycle = readCycle(k) + 1;
    writeCycle(k, cycle);
    render(recommendTopMix5(cycle));
  });

  $("#b10").addEventListener("click", ()=>{
    if(!freq) return;
    const k = "yeongeum720_cycle_10";
    const cycle = readCycle(k) + 1;
    writeCycle(k, cycle);
    render(recommendSpread10(cycle));
  });

  $("#bReset").addEventListener("click", ()=>{
    ["yeongeum720_cycle_5","yeongeum720_cycle_10"].forEach(k => localStorage.removeItem(k));
    setText("#status", "사이클 리셋 완료");
  });

  load();
</script>
</body>
</html>
